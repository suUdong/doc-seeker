# ğŸ§ª í…ŒìŠ¤íŠ¸ ì•„í‚¤í…ì²˜

doc-seekerëŠ” ê°•ë ¥í•œ ë‹¤ì¸µì  í…ŒìŠ¤íŠ¸ ì•„í‚¤í…ì²˜ë¥¼ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤. ì´ ë¬¸ì„œëŠ” í…ŒìŠ¤íŠ¸ ì „ëµ, êµ¬ì¡° ë° ì‹¤í–‰ ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## í…ŒìŠ¤íŠ¸ ì•„í‚¤í…ì²˜ ê°œìš”

doc-seekerì˜ í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ìŒ ì„¸ ê°€ì§€ ê³„ì¸µìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ì—”ë“œíˆ¬ì—”ë“œ í…ŒìŠ¤íŠ¸ (E2E)      â”‚ - API ì—”ë“œí¬ì¸íŠ¸ ë° ì „ì²´ ì‹œìŠ¤í…œ íë¦„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         í†µí•© í…ŒìŠ¤íŠ¸             â”‚ - ëª¨ë“ˆ ê°„ ìƒí˜¸ì‘ìš©
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         ë‹¨ìœ„ í…ŒìŠ¤íŠ¸             â”‚ - ê°œë³„ ê¸°ëŠ¥ ë‹¨ìœ„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” ê°œë³„ ëª¨ë“ˆê³¼ í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ ê²€ì¦í•©ë‹ˆë‹¤.

### ì„ë² ë”© í…ŒìŠ¤íŠ¸ (`test_embedding.py`)

ì„ë² ë”© ëª¨ë“ˆì˜ í•µì‹¬ ê¸°ëŠ¥ ê²€ì¦:

- ëª¨ë¸ ë¡œë”© ê²€ì¦
- ì„ë² ë”© ë²¡í„° ìƒì„± ë° ì •ê·œí™” ê²€ì¦
- ë™ì¼ í…ìŠ¤íŠ¸ì˜ ì¼ê´€ì„± ê²€ì¦
- ìœ ì‚¬ í…ìŠ¤íŠ¸ ê°„ ì˜ë¯¸ì  ìœ ì‚¬ë„ ê²€ì¦
- í•œê¸€ ì²˜ë¦¬ ëŠ¥ë ¥ ê²€ì¦

```python
def test_embedding_creation(self, model_manager):
    """í…ìŠ¤íŠ¸ ì„ë² ë”© ìƒì„± í…ŒìŠ¤íŠ¸"""
    test_text = "ì´ê²ƒì€ ì„ë² ë”© í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤."
    embedding = model_manager.get_embeddings(test_text)

    # ì„ë² ë”© ë²¡í„° í˜•íƒœ í™•ì¸
    assert isinstance(embedding, np.ndarray), "ì„ë² ë”© ê²°ê³¼ê°€ numpy ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤."
    assert embedding.ndim == 1, "ì„ë² ë”© ê²°ê³¼ê°€ 1ì°¨ì› ë²¡í„°ê°€ ì•„ë‹™ë‹ˆë‹¤."
    assert embedding.shape[0] > 0, "ì„ë² ë”© ë²¡í„° ì°¨ì›ì´ 0ì…ë‹ˆë‹¤."
```

## í†µí•© í…ŒìŠ¤íŠ¸

í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ì—¬ëŸ¬ ëª¨ë“ˆì˜ ìƒí˜¸ì‘ìš©ì„ ê²€ì¦í•©ë‹ˆë‹¤.

### RAG ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ (`test_rag.py`)

RAG(Retrieval-Augmented Generation) ì‹œìŠ¤í…œì˜ ì‘ë™ ê²€ì¦:

- ë¬¸ì„œ ì¸ë±ì‹± ê¸°ëŠ¥ ê²€ì¦
- ì§ˆì˜ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ê²€ì¦
- ì»¨í…ìŠ¤íŠ¸ ê²€ìƒ‰ ì •í™•ë„ ê²€ì¦
- ì—ëŸ¬ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ê²€ì¦

```python
def test_query_processing(self, rag_service, mock_model_manager, mock_qdrant_client):
    """ì§ˆì˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸"""
    query = "í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ì…ë‹ˆë‹¤"
    response = rag_service.query(query)

    # ì„ë² ë”©ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
    mock_model_manager.get_embeddings.assert_called_with(query)

    # Qdrant ê²€ìƒ‰ì´ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸
    mock_qdrant_client.search.assert_called_once()
```

## ì—”ë“œíˆ¬ì—”ë“œ í…ŒìŠ¤íŠ¸

ì—”ë“œíˆ¬ì—”ë“œ í…ŒìŠ¤íŠ¸ëŠ” API ì—”ë“œí¬ì¸íŠ¸ì™€ ì „ì²´ ì‹œìŠ¤í…œ íë¦„ì„ ê²€ì¦í•©ë‹ˆë‹¤.

### í†µí•© í…ŒìŠ¤íŠ¸ (`test_integration.py`)

FastAPI ì—”ë“œí¬ì¸íŠ¸ ë° ì „ì²´ ì‹œìŠ¤í…œ ê²€ì¦:

- í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ ê²€ì¦
- ë¬¸ì„œ ì—…ë¡œë“œ-ì¸ë±ì‹±-ì§ˆì˜ ì „ì²´ íë¦„ ê²€ì¦
- ë¬¸ì„œ ê´€ë¦¬ ê¸°ëŠ¥ ê²€ì¦
- ì—ëŸ¬ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒí™© ê²€ì¦
- ì‹¤ì œ ì„œë²„ ì—°ë™ í…ŒìŠ¤íŠ¸(ì„ íƒì )

```python
def test_document_upload_and_query(self, client, sample_document):
    """ë¬¸ì„œ ì—…ë¡œë“œ ë° ì§ˆì˜ í†µí•© í…ŒìŠ¤íŠ¸"""
    # 1. ë¬¸ì„œ ì—…ë¡œë“œ
    with open(sample_document, "rb") as f:
        files = {"file": (os.path.basename(sample_document), f, "application/pdf")}
        upload_response = client.post("/documents/upload/", files=files)

    assert upload_response.status_code == 200
    assert upload_response.json()["success"] is True
```

## í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•

### ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
pytest -v
```

### íŠ¹ì • í…ŒìŠ¤íŠ¸ ëª¨ë“ˆ ì‹¤í–‰

```bash
pytest -v tests/test_embedding.py
pytest -v tests/test_rag.py
pytest -v tests/test_integration.py
```

### íŠ¹ì • í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì‹¤í–‰

```bash
pytest -v tests/test_rag.py::TestRAG::test_query_processing
```

### ì˜µì…˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (í™˜ê²½ë³€ìˆ˜ ì´ìš©)

```bash
# ë¼ì´ë¸Œ ì„œë²„ í…ŒìŠ¤íŠ¸ í™œì„±í™”
RUN_LIVE_TESTS=1 pytest -v tests/test_integration.py::TestIntegration::test_live_server
```

## í…ŒìŠ¤íŠ¸ ëª¨í‚¹ ì „ëµ

ì™¸ë¶€ ì˜ì¡´ì„±ì„ íš¨ê³¼ì ìœ¼ë¡œ ëª¨í‚¹í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

1. **Qdrant í´ë¼ì´ì–¸íŠ¸ ëª¨í‚¹**: ë²¡í„° DB ì˜ì¡´ì„± ê²©ë¦¬
2. **ModelManager ëª¨í‚¹**: ì„ë² ë”© ë° ìƒì„± ëª¨ë¸ ê²©ë¦¬
3. **íŒŒì¼ ì‹œìŠ¤í…œ ëª¨í‚¹**: ì„ì‹œ íŒŒì¼ ì‚¬ìš©ìœ¼ë¡œ ì‹¤ì œ íŒŒì¼ ì‹œìŠ¤í…œ ê²©ë¦¬

```python
@pytest.fixture
def mock_qdrant_client(self):
    """Qdrant í´ë¼ì´ì–¸íŠ¸ ëª¨í‚¹"""
    mock_client = MagicMock()

    # search ë©”ì„œë“œ ëª¨í‚¹
    search_result = [
        MagicMock(payload={"text": "í…ŒìŠ¤íŠ¸ ë¬¸ì„œ ë‚´ìš© 1"}, score=0.95),
        MagicMock(payload={"text": "í…ŒìŠ¤íŠ¸ ë¬¸ì„œ ë‚´ìš© 2"}, score=0.85)
    ]
    mock_client.search.return_value = search_result

    return mock_client
```

## ì§€ì†ì  í†µí•© (CI) ì „ëµ

GitHub Actions ë˜ëŠ” Jenkinsë¥¼ ì‚¬ìš©í•œ CI íŒŒì´í”„ë¼ì¸ êµ¬ì„± ê¶Œì¥:

1. ëª¨ë“  PRì— ëŒ€í•´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
2. ë©”ì¸ ë¸Œëœì¹˜ ë³‘í•© ì‹œ ì „ì²´ í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ ì‹¤í–‰
3. ì •ê¸°ì ì¸ ì•¼ê°„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ìœ¼ë¡œ ì‹œìŠ¤í…œ ì•ˆì •ì„± í™•ì¸

## í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í™•ì¸ì„ ìœ„í•´ pytest-cov ì‚¬ìš© ê¶Œì¥:

```bash
pytest --cov=app tests/
```

## í…ŒìŠ¤íŠ¸ ëª¨ë²” ì‚¬ë¡€

1. ê° í…ŒìŠ¤íŠ¸ëŠ” ë…ë¦½ì ì´ê³  ê²©ë¦¬ë˜ì–´ì•¼ í•¨
2. í…ŒìŠ¤íŠ¸ëŠ” ë¹ ë¥´ê²Œ ì‹¤í–‰ë˜ì–´ì•¼ í•¨ (ëŠë¦° í…ŒìŠ¤íŠ¸ëŠ” ë³„ë„ í‘œì‹œ)
3. ì ì ˆí•œ ì–´ì„¤ì…˜ ë©”ì‹œì§€ë¡œ ì‹¤íŒ¨ ì›ì¸ ëª…í™•íˆ ì œê³µ
4. í…ŒìŠ¤íŠ¸ í”½ìŠ¤ì²˜ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•˜ì—¬ ì¤‘ë³µ ìµœì†Œí™”
5. í™˜ê²½ ì˜ì¡´ì„±ì„ ìµœì†Œí™”í•˜ê³  ëª¨í‚¹ìœ¼ë¡œ ëŒ€ì²´
